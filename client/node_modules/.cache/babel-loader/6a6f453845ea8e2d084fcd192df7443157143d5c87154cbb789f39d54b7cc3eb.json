{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\quoct\\\\Data\\\\Exercise D21KTPM\\\\BCKH C\\u1EA5p Vi\\u1EC7n\\\\Semester-1-Year-3\\\\f2c\\\\v1.0.4\\\\client\\\\src\\\\components\\\\PostList.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport Post from \"./Post\";\nimport socket from '../socket/socket-client';\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport { getLimitPost, getNumberPost } from \"../adapters/post\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PostList() {\n  _s();\n  const [maxPost, setMaxPost] = useState(0);\n  const [fromPage, setFromPage] = useState(1);\n  const [limitPost, setLimitPost] = useState(2);\n  const [post, setPost] = useState([]);\n  const [hasMore, setHasMore] = useState(false);\n\n  // LOAD POST ONE TIME\n  useEffect(() => {\n    fetchData(fromPage - 1, limitPost);\n    getMaxPost();\n\n    // Thêm socket.on handler để lắng nghe sự kiện \"postAdded\"\n    socket.on(\"postAdded\", postA => {\n      setPost(prevPost => [postA, ...prevPost]);\n    });\n    return () => {\n      // Hủy đăng ký sự kiện khi unmount component\n      socket.off(\"postAdded\");\n    };\n  }, []);\n  async function getMaxPost() {\n    const MAXPOST = await getNumberPost();\n    setMaxPost(MAXPOST.numberPost);\n    if (MAXPOST.numberPost > 0) setHasMore(true);\n  }\n  function fetchData(fromPage, toPage) {\n    // Gửi thông báo đến server để lấy bài viết\n    socket.emit(\"getpost\", fromPage, toPage);\n    socket.on(\"getpost\", function (post) {\n      setPost(post);\n    });\n  }\n  async function fetchMoreData() {\n    if (post.length === maxPost) {\n      setHasMore(false);\n      return;\n    }\n    setTimeout(async () => {\n      const toPost = post.length + limitPost;\n\n      // Lấy thêm dữ liệu\n      const data = await getLimitPost(post.length, toPost);\n      const newData = post.concat(data);\n      setPost(newData);\n    }, 1000);\n    /* Độ trễ phải từ 900 trở lên để server kịp xử lý, \r\n    // xảy ra khi infinite scroll hoạt động sẽ lấy dữ liệu từ db\r\n    Nếu tốc độ scroll nhanh hơn dẫn tới việc dữ liệu vừa được xóa xong (client) \r\n    vừa cập nhật xong thì infinite scroll gọi lại\r\n    */\n  }\n\n  return /*#__PURE__*/_jsxDEV(InfiniteScroll, {\n    dataLength: post.length,\n    next: fetchMoreData,\n    hasMore: hasMore,\n    loader: /*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 21\n    }, this),\n    scrollableTarget: \"content\",\n    children: post.map((item, index) => /*#__PURE__*/_jsxDEV(Post, {\n      _id: item._id,\n      sender: item.sender,\n      content: {\n        text: item.content.text,\n        image: item.content.image !== \"\" ? `http://127.0.0.1:3001/uploads/${item.content.image}` : \"\"\n      },\n      creationTime: item.creationTime,\n      comments: item.comments,\n      post: post,\n      setPost: setPost\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 21\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 9\n  }, this);\n}\n_s(PostList, \"05cM10Ao+dyQEDqglkVAO6AMRb8=\");\n_c = PostList;\nvar _c;\n$RefreshReg$(_c, \"PostList\");","map":{"version":3,"names":["React","useState","useEffect","Post","socket","InfiniteScroll","getLimitPost","getNumberPost","jsxDEV","_jsxDEV","PostList","_s","maxPost","setMaxPost","fromPage","setFromPage","limitPost","setLimitPost","post","setPost","hasMore","setHasMore","fetchData","getMaxPost","on","postA","prevPost","off","MAXPOST","numberPost","toPage","emit","fetchMoreData","length","setTimeout","toPost","data","newData","concat","dataLength","next","loader","children","fileName","_jsxFileName","lineNumber","columnNumber","scrollableTarget","map","item","index","_id","sender","content","text","image","creationTime","comments","_c","$RefreshReg$"],"sources":["C:/Users/quoct/Data/Exercise D21KTPM/BCKH Cấp Viện/Semester-1-Year-3/f2c/v1.0.4/client/src/components/PostList.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Post from \"./Post\";\r\nimport socket from '../socket/socket-client'\r\nimport InfiniteScroll from \"react-infinite-scroll-component\";\r\nimport { getLimitPost, getNumberPost } from \"../adapters/post\";\r\n\r\n\r\nexport default function PostList() {\r\n    const [maxPost, setMaxPost] = useState(0)\r\n    const [fromPage, setFromPage] = useState(1)\r\n    const [limitPost, setLimitPost] = useState(2)\r\n    const [post, setPost] = useState([]);\r\n    const [hasMore, setHasMore] = useState(false)\r\n\r\n    // LOAD POST ONE TIME\r\n    useEffect(() => {\r\n        fetchData(fromPage - 1, limitPost)\r\n        \r\n        getMaxPost()\r\n\r\n        // Thêm socket.on handler để lắng nghe sự kiện \"postAdded\"\r\n        socket.on(\"postAdded\", (postA) => {\r\n\r\n            setPost((prevPost) => [postA, ...prevPost]);\r\n\r\n        });\r\n\r\n        return () => {\r\n            // Hủy đăng ký sự kiện khi unmount component\r\n            socket.off(\"postAdded\");\r\n        };\r\n    }, []);\r\n\r\n    async function getMaxPost()\r\n    {\r\n        const MAXPOST = await getNumberPost()\r\n\r\n        setMaxPost(MAXPOST.numberPost)\r\n\r\n        if (MAXPOST.numberPost > 0)\r\n            setHasMore(true)\r\n    }\r\n\r\n    function fetchData(fromPage, toPage)\r\n    {\r\n        // Gửi thông báo đến server để lấy bài viết\r\n        socket.emit(\"getpost\", fromPage, toPage);\r\n       \r\n        socket.on(\"getpost\", function(post) {\r\n            setPost(post)\r\n        })\r\n    }\r\n\r\n    async function fetchMoreData() {\r\n        if (post.length === maxPost)\r\n        {\r\n            setHasMore(false)\r\n            return\r\n        }\r\n\r\n        setTimeout(async () => {\r\n            const toPost = post.length + limitPost\r\n            \r\n            // Lấy thêm dữ liệu\r\n            const data = await getLimitPost(post.length, toPost);\r\n            const newData = post.concat(data)\r\n\r\n            setPost(newData)\r\n\r\n        }, (1000));  \r\n        /* Độ trễ phải từ 900 trở lên để server kịp xử lý, \r\n        // xảy ra khi infinite scroll hoạt động sẽ lấy dữ liệu từ db\r\n        Nếu tốc độ scroll nhanh hơn dẫn tới việc dữ liệu vừa được xóa xong (client) \r\n        vừa cập nhật xong thì infinite scroll gọi lại\r\n        */\r\n    }\r\n\r\n    return (\r\n        <InfiniteScroll\r\n            dataLength={post.length}\r\n            next={fetchMoreData}\r\n            hasMore={hasMore}\r\n            loader={<h4>Loading...</h4>}\r\n            scrollableTarget=\"content\"\r\n        >\r\n            {\r\n                post.map((item, index) => (\r\n                    <Post\r\n                        key={index}\r\n\r\n                        _id={item._id}\r\n\r\n                        sender={item.sender}\r\n\r\n                        content={{\r\n                            text: item.content.text,\r\n                            image: item.content.image !== \"\" ? `http://127.0.0.1:3001/uploads/${item.content.image}` : \"\",\r\n                        }}\r\n\r\n                        creationTime={item.creationTime}\r\n\r\n                        comments={item.comments}\r\n\r\n                        post={post}\r\n\r\n                        setPost={setPost}\r\n                    />\r\n                ))\r\n            }\r\n        </InfiniteScroll>\r\n    );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}